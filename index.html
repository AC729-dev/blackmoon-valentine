<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>黑月沙龍 — 情人節書籤生成器</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Noto+Serif+TC:wght@300;400;500;600;700&family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
<style>
  *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
  :root{
    --cream:#FAF7F2;--warm-white:#F5F0E8;--ink:#2C2824;--ink-light:#6B6560;
    --ink-lighter:#9E9590;--gold:#C4A265;--gold-light:#D4B87A;--rose:#B5706A;
    --rose-light:#D4918B;--border:#E0D8CE;
  }
  html{font-size:16px;-webkit-text-size-adjust:100%}
  body{font-family:'Noto Serif TC',serif;background:var(--cream);color:var(--ink);min-height:100vh;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased}

  .ambient-bg{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
  .ambient-bg::before{content:'';position:absolute;top:-20%;right:-10%;width:400px;height:400px;background:radial-gradient(circle,rgba(196,162,101,.06) 0%,transparent 70%);border-radius:50%;animation:floatA 20s ease-in-out infinite}
  .ambient-bg::after{content:'';position:absolute;bottom:-10%;left:-5%;width:350px;height:350px;background:radial-gradient(circle,rgba(181,112,106,.05) 0%,transparent 70%);border-radius:50%;animation:floatB 25s ease-in-out infinite}
  @keyframes floatA{0%,100%{transform:translate(0,0)}50%{transform:translate(-30px,20px)}}
  @keyframes floatB{0%,100%{transform:translate(0,0)}50%{transform:translate(20px,-15px)}}

  .container{position:relative;z-index:1;max-width:440px;margin:0 auto;padding:32px 20px 48px;min-height:100vh;min-height:100dvh}

  .header{text-align:center;margin-bottom:36px;animation:fadeUp .8s ease}
  .header .logo{width:72px;height:72px;border-radius:50%;object-fit:cover;margin-bottom:16px;opacity:.9}
  .header h1{font-family:'Cormorant Garamond',serif;font-weight:300;font-size:13px;letter-spacing:5px;text-transform:uppercase;color:var(--ink-light);margin-bottom:6px}
  .header h2{font-weight:300;font-size:22px;color:var(--ink);margin-bottom:4px}
  .header .subtitle{font-family:'Cormorant Garamond',serif;font-style:italic;font-weight:300;font-size:12px;color:var(--ink-lighter);letter-spacing:2px}
  .divider{width:32px;height:1px;background:var(--gold);margin:16px auto;opacity:.5}

  .intro{text-align:center;margin-bottom:32px;animation:fadeUp .8s ease .15s both}
  .intro p{font-weight:300;font-size:14px;line-height:2.1;color:var(--ink-light)}
  .intro .theory-note{font-size:12px;color:var(--ink-lighter);margin-top:12px;font-style:italic;line-height:1.8}

  .quiz-section{animation:fadeUp .5s ease}
  .progress-bar{display:flex;justify-content:center;gap:8px;margin-bottom:28px}
  .progress-dot{width:6px;height:6px;border-radius:50%;background:var(--border);transition:all .4s ease}
  .progress-dot.active{background:var(--gold);transform:scale(1.4)}
  .progress-dot.done{background:var(--gold);opacity:.4}

  .question-card{background:rgba(255,255,255,.55);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:2px;padding:28px 22px;animation:fadeUp .4s ease}
  .question-num{font-family:'Cormorant Garamond',serif;font-size:11px;letter-spacing:4px;text-transform:uppercase;color:var(--gold);margin-bottom:14px}
  .question-scenario{font-weight:300;font-size:13px;line-height:1.9;color:var(--ink-lighter);margin-bottom:10px;padding-bottom:10px;border-bottom:.5px solid var(--border)}
  .question-text{font-weight:400;font-size:16px;line-height:1.8;color:var(--ink);margin-bottom:24px}
  .options{display:flex;flex-direction:column;gap:8px}
  .option-btn{display:block;width:100%;text-align:left;padding:14px 16px;font-family:'Noto Serif TC',serif;font-size:14px;font-weight:300;line-height:1.6;color:var(--ink);background:var(--cream);border:1px solid var(--border);border-radius:2px;cursor:pointer;transition:all .25s ease;-webkit-tap-highlight-color:transparent}
  .option-btn:active,.option-btn:hover{background:var(--warm-white);border-color:var(--gold)}
  .option-btn.selected{background:var(--warm-white);border-color:var(--gold)}

  .result-section{animation:fadeUp .7s ease;text-align:center}
  .result-type-label{font-family:'Cormorant Garamond',serif;font-size:11px;letter-spacing:5px;text-transform:uppercase;color:var(--gold);margin-bottom:10px}
  .result-type-name{font-weight:500;font-size:21px;color:var(--ink);margin-bottom:6px}
  .result-en-name{font-family:'Cormorant Garamond',serif;font-size:12px;color:var(--ink-lighter);letter-spacing:2px;margin-bottom:6px}
  .result-traits{font-size:12px;color:var(--gold);letter-spacing:1px;margin-bottom:8px}
  .result-description{font-weight:300;font-size:13px;line-height:2;color:var(--ink-light);margin-bottom:32px;max-width:380px;margin-left:auto;margin-right:auto;text-align:left}

  .bookmark-wrapper{margin-bottom:32px;display:flex;flex-direction:column;align-items:center;gap:20px}
  .bookmark-pair-label{font-family:'Cormorant Garamond',serif;font-size:11px;letter-spacing:4px;text-transform:uppercase;color:var(--ink-lighter);text-align:center;margin-bottom:4px}
  .bookmark-save-btn{display:flex;align-items:center;justify-content:center;gap:6px;font-family:'Noto Serif TC',serif;font-size:12px;font-weight:300;letter-spacing:1px;color:var(--ink-light);background:transparent;border:1px solid var(--border);padding:10px 20px;cursor:pointer;border-radius:1px;margin-top:10px;-webkit-tap-highlight-color:transparent;transition:all .25s ease}
  .bookmark-save-btn:active{border-color:var(--gold);color:var(--ink)}
  .bookmark-save-btn svg{width:14px;height:14px;stroke:currentColor;fill:none;stroke-width:1.5}
  .bookmark-card{position:relative;width:280px;min-height:420px;margin:0 auto;background:var(--cream);border:1px solid var(--border);padding:40px 26px 32px;display:flex;flex-direction:column;justify-content:space-between;align-items:center;text-align:center;animation:bookmarkReveal .8s ease .2s both;box-shadow:0 4px 24px rgba(44,40,36,.06)}
  .bookmark-card::before{content:'';position:absolute;top:14px;left:14px;right:14px;bottom:14px;border:.5px solid var(--border);pointer-events:none;opacity:.4}
  .bookmark-top-logo{width:40px;height:40px;border-radius:50%;object-fit:cover;margin-bottom:16px;opacity:.8}
  .bookmark-quote-zh{font-weight:400;font-size:15px;line-height:2;color:var(--ink);margin-bottom:14px;letter-spacing:.5px}
  .bookmark-quote-original{font-family:'EB Garamond',serif;font-style:italic;font-weight:400;font-size:12px;line-height:1.8;color:var(--ink-lighter);margin-bottom:18px;padding:0 4px}
  .bookmark-author{font-family:'Cormorant Garamond',serif;font-size:11px;letter-spacing:3px;text-transform:uppercase;color:var(--gold);margin-bottom:3px}
  .bookmark-author-zh{font-size:12px;color:var(--ink-lighter);font-weight:300;margin-bottom:20px}
  .bookmark-bottom{width:100%;padding-top:16px;border-top:.5px solid var(--border)}
  .bookmark-brand{font-family:'Cormorant Garamond',serif;font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--ink-lighter);margin-bottom:3px}
  .bookmark-occasion{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:10px;color:var(--ink-lighter);opacity:.5}
  @keyframes bookmarkReveal{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

  .analysis-card{background:rgba(255,255,255,.45);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:2px;padding:24px 20px;margin:0 auto 32px;max-width:380px;text-align:left;animation:fadeUp .6s ease .4s both}
  .analysis-title{font-family:'Cormorant Garamond',serif;font-size:11px;letter-spacing:4px;text-transform:uppercase;color:var(--gold);margin-bottom:12px;text-align:center}
  .analysis-text{font-weight:300;font-size:13px;line-height:2.1;color:var(--ink-light)}

  .actions{display:flex;flex-direction:column;gap:10px;align-items:center;margin-top:28px}
  .btn-primary{font-family:'Noto Serif TC',serif;font-size:13px;font-weight:400;letter-spacing:2px;color:var(--cream);background:var(--ink);border:none;padding:14px 0;cursor:pointer;transition:all .3s ease;border-radius:1px;width:260px;text-align:center;-webkit-tap-highlight-color:transparent}
  .btn-primary:active{background:#3D3833}
  .btn-secondary{font-family:'Noto Serif TC',serif;font-size:13px;font-weight:300;letter-spacing:2px;color:var(--ink-light);background:transparent;border:1px solid var(--border);padding:14px 0;cursor:pointer;transition:all .3s ease;border-radius:1px;width:260px;text-align:center;-webkit-tap-highlight-color:transparent}
  .btn-secondary:active{border-color:var(--gold);color:var(--ink)}
  .btn-ig{display:flex;align-items:center;justify-content:center;gap:8px;font-family:'Noto Serif TC',serif;font-size:13px;font-weight:400;letter-spacing:1px;color:#fff;background:linear-gradient(135deg,#833ab4,#fd1d1d,#fcb045);border:none;padding:14px 0;cursor:pointer;border-radius:1px;width:260px;text-align:center;-webkit-tap-highlight-color:transparent;transition:opacity .3s ease}
  .btn-ig:active{opacity:.85}
  .btn-ig svg{width:18px;height:18px;fill:#fff;flex-shrink:0}

  a.btn-link{display:inline-block;font-family:'Cormorant Garamond',serif;font-size:12px;letter-spacing:2px;color:var(--rose);text-decoration:none;border-bottom:.5px solid var(--rose-light);padding-bottom:2px;transition:all .3s ease;margin-top:6px}

  .footer-cta{text-align:center;margin-top:40px;padding-top:28px;border-top:.5px solid var(--border);animation:fadeUp .5s ease .4s both}
  .footer-cta .cta-label{font-family:'Cormorant Garamond',serif;font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--gold);margin-bottom:10px}
  .footer-cta .cta-text{font-weight:300;font-size:13px;line-height:2;color:var(--ink-light);margin-bottom:14px}
  .footer-cta .cta-links{display:flex;flex-direction:column;align-items:center;gap:6px}

  @keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

  .toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(16px);background:var(--ink);color:var(--cream);font-family:'Noto Serif TC',serif;font-size:12px;font-weight:300;padding:10px 24px;border-radius:2px;opacity:0;transition:all .4s ease;z-index:100;pointer-events:none;white-space:nowrap}
  .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

  .save-modal{position:fixed;inset:0;background:rgba(44,40,36,.85);z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;animation:fadeIn .3s ease}
  .save-modal-hint{color:var(--cream);font-family:'Noto Serif TC',serif;font-size:14px;font-weight:300;text-align:center;margin-bottom:16px;line-height:1.8}
  .save-modal img{max-width:72%;max-height:65vh;border-radius:2px;box-shadow:0 8px 40px rgba(0,0,0,.3)}
  .save-modal-close{margin-top:20px;color:var(--cream);font-family:'Noto Serif TC',serif;font-size:13px;font-weight:300;letter-spacing:2px;background:transparent;border:1px solid rgba(255,255,255,.3);padding:10px 32px;border-radius:1px;cursor:pointer;-webkit-tap-highlight-color:transparent}
  .save-modal-close:active{border-color:var(--gold)}
  @keyframes fadeIn{from{opacity:0}to{opacity:1}}

  #export-canvas{display:none}
</style>
</head>
<body>
<div class="ambient-bg"></div>
<div class="container" id="app">
  <header class="header">
    <img src="" alt="黑月沙龍" class="logo" id="brand-logo">
    <h1>Blackmoon Salon</h1>
    <h2>情人節書籤生成器</h2>
    <div class="subtitle">Valentine's Bookmark Generator</div>
    <div class="divider"></div>
  </header>
  <div class="intro" id="intro-section">
    <p>
      每一段關係，都藏著一句<br>
      尚未被說出的話。<br><br>
      回答五個關於溝通的小問題，<br>
      讓文學為你說出心底的那句話。
    </p>
    <div class="theory-note">靈感源自 Virginia Satir 溝通姿態理論</div>
    <div style="margin-top:24px">
      <button class="btn-primary" onclick="startQuiz()">開始測驗</button>
    </div>
  </div>
  <div class="quiz-section" id="quiz-section" style="display:none"></div>
  <div class="result-section" id="result-section" style="display:none"></div>
</div>
<div class="toast" id="toast"></div>
<canvas id="export-canvas"></canvas>

<script>
const LOGO_SRC = "assets/logo.jpg";
document.getElementById('brand-logo').src = LOGO_SRC;

// ===== QUIZ DATA (Satir 5 stances) =====
const questions = [
  {
    scenario: "週五晚上，你和伴侶約好了一起吃飯。你到了餐廳，對方卻遲到了四十分鐘，到了之後只說了一句「路上塞車」。",
    q: "你會怎麼做？",
    options: [
      { text: "笑著說「沒關係啦，你一定也很辛苦」，主動幫對方拉開椅子", type: "placater" },
      { text: "語氣不好地說「每次都這樣遲到，你到底有沒有把我放在心上？」", type: "debater" },
      { text: "心裡不舒服，但開始分析可能的塞車路段和原因，判斷對方是否合理", type: "computer" },
      { text: "笑著打岔「算了算了，你看他們出了新菜欸！」轉移話題緩和氣氛", type: "humorist" },
      { text: "平靜地說「我等了四十分鐘，有點擔心。下次可以提前傳個訊息嗎？」", type: "leveler" }
    ]
  },
  {
    scenario: "你最近工作壓力很大，回到家只想安靜。伴侶卻興奮地跟你分享今天發生的事。",
    q: "你的第一反應是？",
    options: [
      { text: "硬撐著笑臉聽完，雖然心裡快要爆炸，但不想讓對方失望", type: "placater" },
      { text: "煩躁地說「你沒看到我很累嗎？可以不要現在講嗎！」", type: "debater" },
      { text: "安靜聽著，同時在腦中分析自己為什麼這麼煩躁、是否合理", type: "computer" },
      { text: "邊滑手機邊嗯嗯啊啊，用背景噪音和敷衍回應來避開正面衝突", type: "humorist" },
      { text: "說「我今天真的很疲憊，但我想聽你說。給我十分鐘洗個澡，然後我們好好聊」", type: "leveler" }
    ]
  },
  {
    scenario: "伴侶的朋友在聚會上拿你的外表開了一個不太舒服的玩笑。伴侶在旁邊也笑了。",
    q: "事後你會？",
    options: [
      { text: "算了不提了，告訴自己「他應該不是故意的，我不要小題大做」", type: "placater" },
      { text: "質問伴侶「你朋友當面那樣損我，你居然還笑？你根本不在乎我的感受！」", type: "debater" },
      { text: "回家後獨自冷靜分析：那個玩笑客觀來說到底算不算冒犯？", type: "computer" },
      { text: "當場自嘲「哈哈對啊我就這樣」帶過，回家追劇讓自己別再想", type: "humorist" },
      { text: "找個合適的時機說「今天那個玩笑讓我不太舒服，我希望下次你能幫我說句話」", type: "leveler" }
    ]
  },
  {
    scenario: "你們在一起三年了。最近你發現對方越來越少主動說「我愛你」。",
    q: "這讓你？",
    options: [
      { text: "開始加倍對他好——煮飯、送禮物、寫卡片，希望用行動換來對方的回應", type: "placater" },
      { text: "忍不住說「你是不是不愛我了？你以前不是這樣的，你變了！」", type: "debater" },
      { text: "默默觀察對方近期的行為模式，試圖理性判斷這是正常的感情階段還是警訊", type: "computer" },
      { text: "覺得可能是自己想太多了，約朋友出去玩讓自己開心一點就好", type: "humorist" },
      { text: "找個放鬆的時刻問「我們最近的相處你還開心嗎？我有時會想聽到你的感受」", type: "leveler" }
    ]
  },
  {
    scenario: "你無意間看到伴侶和異性朋友的聊天紀錄，內容沒什麼問題，但語氣很親密。",
    q: "你會？",
    options: [
      { text: "告訴自己不應該多想，一定是自己太敏感、太沒安全感了", type: "placater" },
      { text: "直接拿出來質問「這是誰？你們什麼關係？為什麼用這種語氣講話！」", type: "debater" },
      { text: "先不說，默默回頭蒐集更多資訊和證據再做判斷", type: "computer" },
      { text: "跟好朋友吐槽抱怨一輪發洩完，然後決定算了不跟伴侶提", type: "humorist" },
      { text: "選一個彼此都平靜的時候說「我看到了你的聊天，那個語氣讓我有點在意，我們可以聊聊嗎？」", type: "leveler" }
    ]
  }
];

// ===== PROFILES (Satir 5 stances with user's copy) =====
const profiles = {
  placater: {
    name: "柔水之心",
    enName: "The Placater",
    satir: "討好型",
    traits: "極強的同理心 · 願意為愛退讓 · 溫柔包容",
    description: "討好型的人往往認為退讓是成全大局的唯一方式。你對他人的感受有極強的感知力，願意為愛退讓，溫柔而包容。",
    analysis: "泰戈爾的話賦予了柔水一種積極的力量：你的柔軟不是為了被石頭磨損，而是要用這份包容力去塑形關係。而弗洛姆的哲學則是一記溫柔的當頭棒喝。當你為了滿足別人而委屈、消耗自己時，那並非完整的愛。只有把你自己也納入你那寬廣的同理心之中，你的溫柔才不會枯竭。",
    quotes: [
      {
        zh: "不是槌的打擊，\n乃是水的載歌載舞，\n使鵝卵石臻於完美。",
        original: "Not hammer-strokes, but dance of the water, sings the pebbles into perfection.",
        author: "Rabindranath Tagore",
        authorZh: "泰戈爾"
      },
      {
        zh: "如果我只愛他人，我不算懂得愛；\n唯有當我也愛自己時，\n我才真正懂得了愛。",
        original: "If I can love only others, I cannot love at all. If I can love myself, I can also love others.",
        author: "Erich Fromm",
        authorZh: "艾瑞克·弗洛姆"
      }
    ]
  },
  debater: {
    name: "烈焰之聲",
    enName: "The Debater",
    satir: "辯論型",
    traits: "敢於發聲 · 拒絕被動承受 · 充滿改變的能量",
    description: "辯論型的人外表充滿攻擊性，但內心其實充滿了不被理解的恐懼。你敢於發聲、拒絕被動承受，充滿改變的能量。",
    analysis: "里爾克將指責時張牙舞爪的惡龍（憤怒），重新詮釋為內心極度渴望被愛與被看見的公主（脆弱）。這能提醒你：不要被自己的防衛機制騙了。而亞里斯多德則為憤怒提供了實用的指南：你的力量沒有錯，錯的是盲目燃燒。當你能精準地將這股能量用於「建立界線」與「表達真實需求」時，火焰就能成為照亮關係的火炬，而非燒毀一切的災難。",
    quotes: [
      {
        zh: "或許我們生命中所有的惡龍，\n都是最深切渴望著\n我們去拯救的公主。",
        original: "Perhaps all the dragons in our lives are princesses who are only waiting to see us act with beauty and courage.",
        author: "Rainer Maria Rilke",
        authorZh: "里爾克"
      },
      {
        zh: "任何人都能發脾氣，這很容易。\n但是要在適當的時間、\n以適當的方式發脾氣，\n這卻不容易。",
        original: "Anybody can become angry — that is easy. But to be angry with the right person, to the right degree, at the right time — that is not easy.",
        author: "Aristotle",
        authorZh: "亞里斯多德"
      }
    ]
  },
  computer: {
    name: "鏡湖之思",
    enName: "The Computer",
    satir: "超理智型",
    traits: "追求客觀清晰 · 不被情緒綁架 · 能穩定大局",
    description: "「鏡湖之思」的人常被誤解為冷漠，但你其實是用理解來超越情緒的干擾。追求客觀清晰、不被情緒綁架，總能穩定大局。",
    analysis: "蘇東坡這句詞，賦予了一種美學的從容。溝通中的指責、抱怨與焦慮，就像是「穿林打葉」的暴雨。超理智型就是一種不隨外界風雨起舞的定力。然而，要邁向真正健康的溝通，我們需要明白不被情緒捲入並不等於「隔絕感受」。斯賓諾莎的金句提醒我們，理性的最高境界不是冷漠，而是「理解」。當你把對方的感受也納入需要被妥善對待的客觀事實時，你的理智就會從阻擋別人的冰冷高牆，變成引導關係安全走出風暴的溫暖燈塔。",
    quotes: [
      {
        zh: "莫聽穿林打葉聲，\n何妨吟嘯且徐行。",
        original: "莫聽穿林打葉聲，何妨吟嘯且徐行。",
        author: "蘇軾",
        authorZh: "蘇軾《定風波》"
      },
      {
        zh: "不要哭泣，不要憤慨，\n去理解。",
        original: "Non ridere, non lugere, neque detestari, sed intelligere.",
        author: "Baruch Spinoza",
        authorZh: "斯賓諾莎"
      }
    ]
  },
  humorist: {
    name: "流光之舞",
    enName: "The Humorist",
    satir: "幽默型",
    traits: "靈活敏銳 · 化解沉重 · 保護關係的氣氛",
    description: "「流光之舞」的人本能地知道，有些沉重的現實如果直接碰撞，關係會碎裂。你靈活敏銳、懂得化解沉重、保護關係的氣氛。",
    analysis: "你的幽默和轉移焦點，是為了讓大家有喘息的空間。若要將這份靈活轉化為健康的溝通，卓別林的話給出了極好的指引：真正的幽默不是為了永遠逃避現實，而是為了創造一個安全的心理緩衝區。當你成功用幽默卸下大家的防衛、活絡了僵硬的氣氛之後，最勇敢的做法是趁著關係變得柔軟時，輕輕地把焦點帶回原本的核心問題上。這樣一來，你的幽默就不再是逃跑的煙霧彈，而是拉近彼此距離、共同面對挑戰的最強潤滑劑。",
    quotes: [
      {
        zh: "我們擁有藝術，\n是為了不被真理擊垮。",
        original: "We have art in order not to die of the truth.",
        author: "Friedrich Nietzsche",
        authorZh: "尼采"
      },
      {
        zh: "為了能夠真正地歡笑，\n你必須能夠承受你的痛苦，\n並與之共舞。",
        original: "To truly laugh, you must be able to take your pain, and play with it.",
        author: "Charlie Chaplin",
        authorZh: "查理·卓別林"
      }
    ]
  },
  leveler: {
    name: "坦誠之鑰",
    enName: "The Leveler",
    satir: "一致型",
    traits: "內外一致 · 誠實而溫柔 · 同時照顧自他",
    description: "恭喜你，一致型是溝通的理想狀態。你能在表達自己的同時照顧對方的感受，言行一致、誠實而溫柔。",
    analysis: "吳爾芙一語道破了一致的起點：在向外表達之前，必須先向內誠實。如果你連自己的悲傷、憤怒或恐懼都不敢承認，你說出來的話就缺乏靈魂。齊克果則將這種坦誠拉高到了生命意義的層次。一致型溝通不僅僅是為了解決衝突，它更是你活出真實自我、拒絕在世界面前偽裝的勇敢實踐。",
    quotes: [
      {
        zh: "如果我不對自己說真話，\n我也無法對別人說真話。",
        original: "If I do not tell the truth about myself, I cannot tell it about other people.",
        author: "Virginia Woolf",
        authorZh: "維吉尼亞·吳爾芙"
      },
      {
        zh: "要成為你真正的自己，\n這是人生中最偉大的成就。",
        original: "To be that self which one truly is, is indeed the greatest attainment.",
        author: "Søren Kierkegaard",
        authorZh: "齊克果"
      }
    ]
  }
};

let currentQ = 0;
let answers = [];
let currentResult = null;

function startQuiz() {
  document.getElementById('intro-section').style.display = 'none';
  document.getElementById('quiz-section').style.display = 'block';
  renderQuestion();
}

function renderQuestion() {
  const q = questions[currentQ];
  const section = document.getElementById('quiz-section');
  // Shuffle options for each render
  const shuffled = [...q.options].sort(() => Math.random() - 0.5);

  let dots = '';
  for (let i = 0; i < questions.length; i++) {
    const cls = i < currentQ ? 'done' : i === currentQ ? 'active' : '';
    dots += '<div class="progress-dot ' + cls + '"></div>';
  }

  let opts = shuffled.map(opt =>
    '<button class="option-btn" onclick="selectAnswer(\'' + opt.type + '\', this)">' + opt.text + '</button>'
  ).join('');

  section.innerHTML =
    '<div class="progress-bar">' + dots + '</div>' +
    '<div class="question-card">' +
    '<div class="question-num">Question ' + (currentQ + 1) + ' / ' + questions.length + '</div>' +
    '<div class="question-scenario">' + q.scenario + '</div>' +
    '<div class="question-text">' + q.q + '</div>' +
    '<div class="options">' + opts + '</div>' +
    '</div>';
}

function selectAnswer(type, btn) {
  btn.parentElement.querySelectorAll('.option-btn').forEach(function(b) { b.style.pointerEvents = 'none'; });
  btn.classList.add('selected');
  answers.push(type);
  setTimeout(function() {
    currentQ++;
    if (currentQ < questions.length) renderQuestion();
    else showResult();
  }, 350);
}

function getResultType() {
  var c = {};
  answers.forEach(function(a) { c[a] = (c[a] || 0) + 1; });
  // Sort by count desc, then by last appearance for tiebreaking
  var entries = Object.entries(c).sort(function(a, b) {
    if (b[1] !== a[1]) return b[1] - a[1];
    return answers.lastIndexOf(b[0]) - answers.lastIndexOf(a[0]);
  });
  return entries[0][0];
}

function showResult() {
  document.getElementById('quiz-section').style.display = 'none';
  var section = document.getElementById('result-section');
  section.style.display = 'block';

  var type = getResultType();
  var profile = profiles[type];
  var q1 = profile.quotes[0];
  var q2 = profile.quotes[1];
  currentResult = { profile: profile, quotes: [q1, q2] };

  var q1ZhHTML = q1.zh.replace(/\n/g, '<br>');
  var q2ZhHTML = q2.zh.replace(/\n/g, '<br>');

  section.innerHTML =
    '<div class="result-type-label">Your Communication Style</div>' +
    '<div class="result-type-name">' + profile.name + '</div>' +
    '<div class="result-en-name">' + profile.enName + ' · ' + profile.satir + '</div>' +
    '<div class="result-traits">' + profile.traits + '</div>' +
    '<div class="divider"></div>' +
    '<div class="result-description">' + profile.description + '</div>' +

    '<div class="bookmark-wrapper">' +
    '<div class="bookmark-pair-label">Bookmark I</div>' +
    '<div class="bookmark-card" id="bookmark-card-1">' +
    '<div>' +
    '<img src="' + LOGO_SRC + '" alt="" class="bookmark-top-logo">' +
    '<div class="bookmark-quote-zh">' + q1ZhHTML + '</div>' +
    '<div class="bookmark-quote-original">' + q1.original + '</div>' +
    '<div class="bookmark-author">' + q1.author + '</div>' +
    '<div class="bookmark-author-zh">' + q1.authorZh + '</div>' +
    '</div>' +
    '<div class="bookmark-bottom">' +
    '<div class="bookmark-brand">Blackmoon Salon</div>' +
    '<div class="bookmark-occasion">Valentine\'s 2026</div>' +
    '</div>' +
    '</div>' +
    '<button class="bookmark-save-btn" onclick="downloadSingle(0)">' +
    '<svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>' +
    '儲存此書籤' +
    '</button>' +

    '<div class="bookmark-pair-label">Bookmark II</div>' +
    '<div class="bookmark-card" id="bookmark-card-2" style="animation-delay:.4s">' +
    '<div>' +
    '<img src="' + LOGO_SRC + '" alt="" class="bookmark-top-logo">' +
    '<div class="bookmark-quote-zh">' + q2ZhHTML + '</div>' +
    '<div class="bookmark-quote-original">' + q2.original + '</div>' +
    '<div class="bookmark-author">' + q2.author + '</div>' +
    '<div class="bookmark-author-zh">' + q2.authorZh + '</div>' +
    '</div>' +
    '<div class="bookmark-bottom">' +
    '<div class="bookmark-brand">Blackmoon Salon</div>' +
    '<div class="bookmark-occasion">Valentine\'s 2026</div>' +
    '</div>' +
    '</div>' +
    '<button class="bookmark-save-btn" onclick="downloadSingle(1)">' +
    '<svg viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>' +
    '儲存此書籤' +
    '</button>' +
    '</div>' +

    '<div class="analysis-card">' +
    '<div class="analysis-title">Reading Guide</div>' +
    '<div class="analysis-text">' + profile.analysis + '</div>' +
    '</div>' +

    '<div class="actions">' +
    '<button class="btn-ig" onclick="shareToIG()">' +
    '<svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>' +
    '分享到 Instagram Story' +
    '</button>' +
    '<button class="btn-secondary" onclick="restartQuiz()">重新測驗</button>' +
    '</div>' +

    '<div class="footer-cta">' +
    '<div class="cta-label">Ceci 溝通教室</div>' +
    '<div class="cta-text">想學會更好的溝通方式？</div>' +
    '<div class="cta-links">' +
    '<a href="https://ceciwu.com/" target="_blank" class="btn-link">探索更多 → ceciwu.com</a>' +
    '<a href="https://www.instagram.com/blackmoon_salon/" target="_blank" class="btn-link">追蹤 @blackmoon_salon</a>' +
    '</div>' +
    '</div>';

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function restartQuiz() {
  currentQ = 0; answers = []; currentResult = null;
  document.getElementById('result-section').style.display = 'none';
  document.getElementById('intro-section').style.display = 'block';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ===== EXPORT =====

// Bookmark-only canvas (for individual save) — JPG
function drawBookmarkCanvas(q) {
  return new Promise(function(resolve) {
    var W = 600, H = 960, S = 2;
    var canvas = document.createElement('canvas');
    canvas.width = W * S; canvas.height = H * S;
    var ctx = canvas.getContext('2d');
    ctx.scale(S, S);
    ctx.fillStyle = '#FAF7F2';
    ctx.fillRect(0, 0, W, H);
    ctx.strokeStyle = '#E0D8CE'; ctx.lineWidth = 0.5;
    ctx.strokeRect(28, 28, W - 56, H - 56);
    var cx = W / 2;
    ctx.textAlign = 'center';

    var logo = new Image();
    logo.onload = function() {
      ctx.save();
      ctx.beginPath();
      ctx.arc(cx, 72, 36, 0, Math.PI * 2);
      ctx.clip();
      ctx.drawImage(logo, cx - 36, 36, 72, 72);
      ctx.restore();

      ctx.fillStyle = '#2C2824';
      ctx.font = '400 16px "Noto Serif TC", serif';
      var zhLines = q.zh.split('\n').reduce(function(acc, l) { return acc.concat(wrapText(ctx, l, W - 100)); }, []);
      var y = 160;
      zhLines.forEach(function(line) { ctx.fillText(line, cx, y); y += 34; });

      y += 10;
      ctx.fillStyle = '#9E9590';
      ctx.font = 'italic 12px "EB Garamond", serif';
      wrapText(ctx, q.original, W - 90).forEach(function(line) { ctx.fillText(line, cx, y); y += 22; });

      y += 20;
      ctx.fillStyle = '#C4A265';
      ctx.font = '11px "Cormorant Garamond", serif';
      ctx.fillText(q.author.toUpperCase(), cx, y);
      y += 20;
      ctx.fillStyle = '#9E9590';
      ctx.font = '300 12px "Noto Serif TC", serif';
      ctx.fillText(q.authorZh, cx, y);

      var by = H - 70;
      ctx.strokeStyle = '#E0D8CE'; ctx.lineWidth = 0.5;
      ctx.beginPath(); ctx.moveTo(60, by); ctx.lineTo(W - 60, by); ctx.stroke();
      ctx.fillStyle = '#9E9590';
      ctx.font = '10px "Cormorant Garamond", serif';
      ctx.fillText('BLACKMOON SALON', cx, by + 22);
      ctx.font = 'italic 10px "Cormorant Garamond", serif';
      ctx.globalAlpha = 0.5;
      ctx.fillText("Valentine's 2026", cx, by + 38);
      ctx.globalAlpha = 1;
      resolve(canvas);
    };
    logo.src = LOGO_SRC;
  });
}

// IG Story canvas (1080×1920) — bookmark centered with @ handles
function drawStoryCanvas(q) {
  return new Promise(function(resolve) {
    var W = 1080, H = 1920, S = 1;
    var canvas = document.createElement('canvas');
    canvas.width = W; canvas.height = H;
    var ctx = canvas.getContext('2d');

    // Background
    ctx.fillStyle = '#FAF7F2';
    ctx.fillRect(0, 0, W, H);

    // Subtle gradient overlay
    var grd = ctx.createRadialGradient(W/2, H*0.35, 100, W/2, H*0.35, W);
    grd.addColorStop(0, 'rgba(196,162,101,0.04)');
    grd.addColorStop(1, 'rgba(196,162,101,0)');
    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, W, H);

    var cx = W / 2;
    ctx.textAlign = 'center';

    // Bookmark card area
    var cardW = 520, cardH = 820;
    var cardX = (W - cardW) / 2;
    var cardY = 200;

    // Card border
    ctx.strokeStyle = '#E0D8CE'; ctx.lineWidth = 1;
    ctx.strokeRect(cardX, cardY, cardW, cardH);
    // Inner border
    ctx.strokeStyle = '#E0D8CE'; ctx.lineWidth = 0.5;
    ctx.globalAlpha = 0.4;
    ctx.strokeRect(cardX + 16, cardY + 16, cardW - 32, cardH - 32);
    ctx.globalAlpha = 1;

    var logo = new Image();
    logo.onload = function() {
      // Logo
      var logoR = 32;
      ctx.save();
      ctx.beginPath();
      ctx.arc(cx, cardY + 60, logoR, 0, Math.PI * 2);
      ctx.clip();
      ctx.drawImage(logo, cx - logoR, cardY + 60 - logoR, logoR * 2, logoR * 2);
      ctx.restore();

      // Chinese quote
      ctx.fillStyle = '#2C2824';
      ctx.font = '400 28px "Noto Serif TC", serif';
      var zhLines = q.zh.split('\n').reduce(function(acc, l) { return acc.concat(wrapText(ctx, l, cardW - 80)); }, []);
      var y = cardY + 140;
      zhLines.forEach(function(line) { ctx.fillText(line, cx, y); y += 52; });

      // Original quote
      y += 16;
      ctx.fillStyle = '#9E9590';
      ctx.font = 'italic 20px "EB Garamond", serif';
      wrapText(ctx, q.original, cardW - 70).forEach(function(line) { ctx.fillText(line, cx, y); y += 34; });

      // Author
      y += 28;
      ctx.fillStyle = '#C4A265';
      ctx.font = '18px "Cormorant Garamond", serif';
      ctx.fillText(q.author.toUpperCase(), cx, y);
      y += 28;
      ctx.fillStyle = '#9E9590';
      ctx.font = '300 20px "Noto Serif TC", serif';
      ctx.fillText(q.authorZh, cx, y);

      // Card bottom line
      var bottomLine = cardY + cardH - 60;
      ctx.strokeStyle = '#E0D8CE'; ctx.lineWidth = 0.5;
      ctx.beginPath(); ctx.moveTo(cardX + 50, bottomLine); ctx.lineTo(cardX + cardW - 50, bottomLine); ctx.stroke();
      ctx.fillStyle = '#9E9590';
      ctx.font = '16px "Cormorant Garamond", serif';
      ctx.fillText('BLACKMOON SALON', cx, bottomLine + 28);
      ctx.font = 'italic 14px "Cormorant Garamond", serif';
      ctx.globalAlpha = 0.5;
      ctx.fillText("Valentine's 2026", cx, bottomLine + 48);
      ctx.globalAlpha = 1;

      resolve(canvas);
    };
    logo.src = LOGO_SRC;
  });
}

function wrapText(ctx, text, maxW) {
  var chars = text.split('');
  var lines = []; var cur = '';
  for (var i = 0; i < chars.length; i++) {
    var test = cur + chars[i];
    if (ctx.measureText(test).width > maxW && cur) { lines.push(cur); cur = chars[i]; }
    else cur = test;
  }
  if (cur) lines.push(cur);
  return lines;
}

// Download single bookmark — use Web Share API to save to Photos on iOS
function downloadSingle(idx) {
  var q = currentResult.quotes[idx];
  drawBookmarkCanvas(q).then(function(canvas) {
    canvas.toBlob(function(blob) {
      var file = new File([blob], 'blackmoon-valentine-bookmark-' + (idx + 1) + '.jpg', { type: 'image/jpeg' });
      // Try Web Share API first (triggers native share sheet → Save Image on iOS)
      if (navigator.share && navigator.canShare) {
        var shareData = { files: [file] };
        if (navigator.canShare(shareData)) {
          navigator.share(shareData).then(function() {
            showToast('書籤已儲存 ✦');
          }).catch(function(err) {
            if (err.name !== 'AbortError') showImageModal(canvas);
          });
          return;
        }
      }
      // Fallback: show image in modal for long-press save
      showImageModal(canvas);
    }, 'image/jpeg', 0.95);
  });
}

// Show image in fullscreen modal for long-press save
function showImageModal(canvas) {
  var modal = document.createElement('div');
  modal.className = 'save-modal';
  modal.innerHTML =
    '<div class="save-modal-hint">長按圖片 → 儲存到相簿</div>' +
    '<img src="' + canvas.toDataURL('image/jpeg', 0.95) + '">' +
    '<button class="save-modal-close" onclick="this.parentElement.remove()">關閉</button>';
  document.body.appendChild(modal);
}

// Share to IG — use Story-sized 1080×1920 canvas
function shareToIG() {
  var quotes = currentResult.quotes;
  drawStoryCanvas(quotes[0]).then(function(canvas1) {
    canvas1.toBlob(function(blob1) {
      drawStoryCanvas(quotes[1]).then(function(canvas2) {
        canvas2.toBlob(function(blob2) {
          var file1 = new File([blob1], 'blackmoon-valentine-story-1.jpg', { type: 'image/jpeg' });
          var file2 = new File([blob2], 'blackmoon-valentine-story-2.jpg', { type: 'image/jpeg' });

          if (navigator.share && navigator.canShare) {
            var shareData = { files: [file1, file2] };
            if (navigator.canShare(shareData)) {
              navigator.share(shareData).then(function() {
                showToast('已開啟分享 ✦');
              }).catch(function() { fallbackStoryDownload(canvas1, canvas2); });
              return;
            }
            // Try single file
            var single = { files: [file1] };
            if (navigator.canShare(single)) {
              navigator.share(single).then(function() {
                showToast('已開啟分享 ✦');
              }).catch(function() { fallbackStoryDownload(canvas1, canvas2); });
              return;
            }
          }
          fallbackStoryDownload(canvas1, canvas2);
        }, 'image/jpeg', 0.95);
      });
    }, 'image/jpeg', 0.95);
  });
}

function fallbackStoryDownload(c1, c2) {
  var link1 = document.createElement('a');
  link1.download = 'blackmoon-valentine-story-1.jpg';
  link1.href = c1.toDataURL('image/jpeg', 0.95);
  link1.click();
  setTimeout(function() {
    var link2 = document.createElement('a');
    link2.download = 'blackmoon-valentine-story-2.jpg';
    link2.href = c2.toDataURL('image/jpeg', 0.95);
    link2.click();
    showToast('Story 圖片已儲存，請到 Instagram 分享 ✦');
  }, 600);
}

function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2800);
}
</script>
</body>
</html>
